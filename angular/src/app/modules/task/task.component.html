<div class="row clearfix task-wrapper" [@routerTransition]>
  <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
    <div class="card main-content">
      <div class="header">
        <h2>{{ "Manage Tasks" | localize }}</h2>
        <ul class="header-dropdown m-r--5">
          <li>
            <button
              mat-icon-button
              name="menuBtn"
              [matMenuTriggerFor]="headerMenu"
              class="header-dropdown-mat-icon-button"
            >
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #headerMenu="matMenu">
              <button mat-menu-item name="refreshBtn" (click)="getAllData()">
                <mat-icon>refresh</mat-icon>
                <span>{{ "Refresh" | localize }}</span>
              </button>
            </mat-menu>
          </li>
        </ul>
      </div>
      <div class="body table-responsive task-body" [busy]="isTableLoading">
        <div class="task-header-menu">
          <div>
            <button
              *ngIf="permission.isGranted(ADD_TASK)"
              mat-raised-button
              name="createBtn"
              color="primary"
              class="pull-left"
              (click)="createTask()"
            >
              <mat-icon>add</mat-icon>New Task
            </button>
          </div>
          <div class="task-header-menu-search-wrapper">
            <mat-form-field
              appearance="outline"
              class="task-header-menu-search-wrapper"
            >
              <mat-label>Search by task name</mat-label>
              <input
                matInput
                [(ngModel)]="searchText"
                (keyup.enter)="searchTask()"
                name="searchText"
                type="text"
                maxlength="128"
              />
              <i class="icon-32 material-icons" matPrefix>search</i>
            </mat-form-field>
          </div>
        </div>
        <div class="task-table-wrapper">
          <div *ngFor="let task of mapTasks; index as i">
            <div>
              <h5>
                {{ task.name }} ({{ task.items.length }})
              </h5>
              <p *ngIf="task.name == 'Common Task'" style="font-weight: normal">
                These tasks are automatically added to all new projects
              </p>
              <p *ngIf="task.name == 'Other Task'" style="font-weight: normal">
                These task must be manually added to projects
              </p>
            </div>
          <div class="task-table-content">
            <table class="table table-hover" [busy]="isTableLoading">
              <thead class="bg-light">
                <tr>
                  <th>Name</th>
                  <th class="task-table-action-label" >Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let listname of task.items; index as i">
                  <td align="start" class="task-table-label">
                    <span>{{ listname.name }}</span>
                  </td>
                  <td align="end" class="task-table-action task-table-action_response">
                    <button
                      [name]="'editBtn-' + listname.id"
                      *ngIf="permission.isGranted(EDIT_TASK)"
                      color="primary"
                      mat-icon-button
                      (click)="editTask(listname)"
                    >
                      <mat-icon class="task-table-action-icon">edit</mat-icon>
                    </button>
                    <div *ngIf="task.name == 'Common Task'" class="task-table-action_common">
                      <button
                        [name]="'archiveBtn-' + listname.id"
                        color="primary"
                        *ngIf="
                          listname.isDeleted == false &&
                          permission.isGranted(CHANGE_STATUS_TASK)
                        "
                        mat-icon-button
                        (click)="archiveTask(listname)"
                      >
                        <mat-icon class="task-table-action-icon">archive</mat-icon>
                      </button>
                      <button
                        [name]="'unarchiveBtn-' + listname.id"
                        color="primary"
                        *ngIf="
                          listname.isDeleted == true &&
                          permission.isGranted(CHANGE_STATUS_TASK)
                        "
                        mat-icon-button
                        (click)="unArchiveTask(listname)"
                      >
                        <mat-icon class="task-table-action-icon">unarchive</mat-icon>
                      </button>
                      <button
                        class="white-color"
                        [name]="'deleteBtn-' + listname.id"
                        color="primary"
                        *ngIf="permission.isGranted(DELETE_TASK)"
                        [disabled]="!listname.isDeleted"
                        mat-icon-button
                        (click)="deleteTask(listname)"
                      >
                        <mat-icon class="task-table-action-icon">delete</mat-icon>
                      </button>
                    </div>
                    <button
                      *ngIf="
                        task.name == 'Other Task' &&
                        permission.isGranted(DELETE_TASK)
                      "
                      mat-icon-button
                      color="primary"
                      [name]="'deleteBtn-' + listname.id"
                      (click)="deleteTask(listname)"
                    >
                      <mat-icon class="task-table-action-icon">delete</mat-icon>
                    </button>
                  </td>
                  <td align="end"  class="task-table-action">
                    <div *ngIf="task.name =='Common Task'">
                      <button [name]="'archiveBtn-'+listname.id" *ngIf="listname.isDeleted == false && permission.isGranted(CHANGE_STATUS_TASK)" mat-raised-button (click)="archiveTask(listname)">
                        <span>Archive</span>
                      </button>
                      <button [name]="'unarchiveBtn-'+listname.id" *ngIf="listname.isDeleted == true && permission.isGranted(CHANGE_STATUS_TASK)" mat-raised-button (click)="unArchiveTask(listname)">
                          <span>Unarchive</span>
                        </button>
                      <button class="btn-danger white-color" [name]="'deleteBtn-'+listname.id" *ngIf="permission.isGranted(DELETE_TASK)" [disabled]="!listname.isDeleted " mat-raised-button 
                        (click)="deleteTask(listname)">
                        <span>Delete</span>
                      </button>
                    </div>
                    <button class="btn-danger white-color" *ngIf="task.name =='Other Task' && permission.isGranted(DELETE_TASK)" mat-raised-button [name]="'deleteBtn-'+listname.id" (click)="deleteTask(listname)">
                      <span>Delete</span>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
